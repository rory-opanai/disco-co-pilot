(()=>{var e={};e.id=293,e.ids=[293],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5530:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c}),s(8207),s(1163),s(2874);var r=s(7105),a=s(5265),n=s(157),i=s.n(n),l=s(4665),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["call",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8207)),"/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/call/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,1163)),"/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,2874,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/call/page.tsx"],u="/call/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/call/page",pathname:"/call",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3672:(e,t,s)=>{Promise.resolve().then(s.bind(s,1822))},2040:(e,t,s)=>{Promise.resolve().then(s.bind(s,2698)),Promise.resolve().then(s.bind(s,2109)),Promise.resolve().then(s.bind(s,98))},4084:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,3817,23)),Promise.resolve().then(s.t.bind(s,9323,23)),Promise.resolve().then(s.t.bind(s,2204,23)),Promise.resolve().then(s.t.bind(s,820,23)),Promise.resolve().then(s.t.bind(s,5915,23)),Promise.resolve().then(s.t.bind(s,1611,23))},1822:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>f,dynamic:()=>h});var r=s(9899),a=s(5507),n=s(6153);function i({items:e}){return r.jsx("div",{className:"h-96 overflow-y-auto",children:e.map((e,t)=>(0,r.jsxs)("div",{className:"text-sm px-2 py-1 "+(t%2==0?"bg-white":"bg-slate-50"),children:[(0,r.jsxs)("span",{className:"mr-2 inline-flex items-center gap-1",children:[r.jsx("span",{className:"chip "+("Customer"===e.speaker?"bg-rose-50 text-rose-700":"bg-sky-50 text-sky-700"),children:e.speaker}),r.jsx("span",{className:"text-xs font-mono text-slate-500",children:function(e){try{return new Date(e||"").toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return""}}(e.timestamp)})]}),r.jsx("span",{children:e.text})]},t))})}let l=["Pain","Impact","Current Solution","Desired Outcome","Use Case","Stakeholders","Budget","Timeline","Decision Process","Risks","Metrics","Compliance"];function o({coverage:e}){let t=(0,a.useMemo)(()=>{let t=l.length,s=0;for(let t of l){let r=e[t];"known"===r?s+=1:"partial"===r&&(s+=.3)}return Math.round(s/t*100)},[e]);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-2",children:["Progress: ",(0,r.jsxs)("span",{className:"font-semibold",children:[t,"%"]})]}),r.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:l.map(t=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:function(e){switch(e){case"known":return"#16a34a";case"partial":return"#f59e0b";default:return"#9ca3af"}}(e[t])}}),r.jsx("span",{children:t})]},t))})]})}function c({title:e,nbq:t,onAccept:s,onSkip:n,onQueue:i,bridgeQuote:l,bridgeTimestamp:o}){let[c,u]=(0,a.useState)("consultative"),[m,p]=(0,a.useState)({}),[h,x]=(0,a.useState)("reflect"),f=(0,a.useMemo)(()=>{var e;if(!t)return"";let s=t.question||"";if(m.open&&(s=s.replace(/^\s*(is|are|do|does|did|can|would|could|should)\b.*\?*$/i,e=>e.replace(/^(is|are)/i,"How").replace(/^(do|does|did)/i,"How").replace(/^(can|would|could|should)/i,"What")).replace(/\?*$/,"?")),m.soften&&(s=s.replace(/^what\b/i,"What").replace(/\?*$/,"").replace(/^(.+)$/,e=>`Could you share ${d(e).replace(/^could you share\s+/i,"")}`)+"?"),m.empath&&(s=s.replace(/^(.+)$/,e=>`Appreciate what you shared — ${d(e)}`)),m.shorten&&(s=function(e){let t=e.split(/[.;:!?]/)[0];return t.length>120?t.slice(0,120)+"…?":t+(t.endsWith("?")?"":"?")}(s)),e=s,s="consultative"===c?e:"curious"===c?e.replace(/^(.+)$/,e=>`I'm curious — ${d(e)}`):"exec"===c?e.replace(/^(.+)$/,e=>`From a business outcomes standpoint, ${d(e)}`):"casual"===c?e.replace(/^(.+)$/,e=>`Quick one — ${d(e)}`):e,h&&l){let e=l.trim().slice(0,100),t=o?` (${function(e){try{return new Date(e||"").toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch{return""}}(o)})`:"";"reflect"===h&&(s=`You mentioned “${e}”${t}. ${s}`),"clarify"===h&&(s=`Just to clarify on “${e}”${t}, ${s}`),"transition"===h&&(s=`To build on “${e}”${t}, ${s}`)}return s},[t,c,m,h,l,o]);return(0,r.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[(0,r.jsxs)("div",{className:"text-slate-600 text-sm mb-2 flex items-center justify-between",children:[r.jsx("div",{className:"font-medium",children:e}),t?.source&&r.jsx("span",{className:"badge "+("fast"===t.source?"badge-soft-primary":"badge-soft-success"),children:"fast"===t.source?"Fast":"Refined"})]}),t?(0,r.jsxs)("div",{className:"space-y-3",children:[r.jsx("div",{className:"text-xl font-semibold leading-snug",children:f}),(0,r.jsxs)("div",{className:"text-xs text-slate-600",children:["Why: ",t.grounded_in||t.checklist_category||"Guidance"]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[r.jsx("div",{className:"flex gap-1",role:"group","aria-label":"Tone",children:[["consultative","Consultative"],["curious","Curious"],["exec","Executive"],["casual","Casual"]].map(([e,t])=>r.jsx("button",{className:`px-2 py-0.5 rounded border ${c===e?"bg-slate-900 text-white":"bg-white text-slate-800"}`,onClick:()=>u(e),children:t},e))}),(0,r.jsxs)("div",{className:"flex gap-1",role:"group","aria-label":"Transforms",children:[r.jsx("button",{className:"px-2 py-0.5 rounded border",onClick:()=>p(e=>({...e,soften:!e.soften})),children:"Soften"}),r.jsx("button",{className:"px-2 py-0.5 rounded border",onClick:()=>p(e=>({...e,shorten:!e.shorten})),children:"Shorten"}),r.jsx("button",{className:"px-2 py-0.5 rounded border",onClick:()=>p(e=>({...e,open:!e.open})),children:"Open‑ended"}),r.jsx("button",{className:"px-2 py-0.5 rounded border",onClick:()=>p(e=>({...e,empath:!e.empath})),children:"Empathetic"})]}),(0,r.jsxs)("div",{className:"flex gap-1",role:"group","aria-label":"Bridge",children:[r.jsx("button",{className:`px-2 py-0.5 rounded border ${"reflect"===h?"bg-slate-100":""}`,onClick:()=>x("reflect"),children:"Reflect"}),r.jsx("button",{className:`px-2 py-0.5 rounded border ${"clarify"===h?"bg-slate-100":""}`,onClick:()=>x("clarify"),children:"Clarify"}),r.jsx("button",{className:`px-2 py-0.5 rounded border ${"transition"===h?"bg-slate-100":""}`,onClick:()=>x("transition"),children:"Transition"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[s&&r.jsx("button",{className:"btn btn-success text-xs px-2 py-1",onClick:s,children:"Accept"}),n&&r.jsx("button",{className:"btn btn-secondary text-xs px-2 py-1",onClick:n,children:"Skip"}),i&&r.jsx("button",{className:"btn btn-secondary text-xs px-2 py-1",onClick:i,title:"Show on next pause",children:"Queue for next pause"})]})]}):r.jsx("div",{className:"text-slate-500 text-sm",children:"Awaiting suggestion…"})]})}function d(e){return e.slice(0,1).toLowerCase()+e.slice(1)}function u({sessionId:e,connected:t,transcript:s,coverage:a,nbqItems:n,goodMoment:l,onNbqActionAt:d,onNbqRefreshNow:u,onQueueForPauseAt:m}){let p=[...s].reverse().find(e=>"Customer"===e.speaker),h=p?.text||"",x=p?.timestamp||"";return(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{title:"Open Questions",idx:0},{title:"Avg Response Time",idx:1},{title:"Resolved Today",idx:2},{title:"High Priority",idx:3}].map(e=>r.jsx(c,{title:e.title,nbq:n[e.idx],onAccept:n[e.idx]?()=>d(e.idx,"accept"):void 0,onSkip:n[e.idx]?()=>d(e.idx,"skip"):void 0,onQueue:()=>m&&m(e.idx),bridgeQuote:h,bridgeTimestamp:x},e.title))}),(0,r.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"md:col-span-2 card",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("div",{className:"font-semibold",children:"Transcription"}),r.jsx("div",{className:"text-xs flex items-center gap-2",children:l?r.jsx("span",{className:"text-emerald-700 bg-emerald-100 rounded px-2 py-0.5",children:"Now’s a good moment"}):r.jsx("span",{className:t?"text-green-600":"text-red-600",children:t?"Listening…":"Connecting..."})})]}),r.jsx(i,{items:s})]}),(0,r.jsxs)("div",{className:"card",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Checklist Progress"}),r.jsx(o,{coverage:a})]})]}),r.jsx("div",{className:"text-xs text-slate-500",children:"NBQs auto-refresh and replace when answered."})]})}function m({open:e,onToggle:t,events:s,onClear:n}){let i=(0,a.useRef)(null);return(0,r.jsxs)("div",{className:"border rounded",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-slate-100",children:[r.jsx("div",{className:"font-medium",children:"Realtime Debug"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("button",{className:"text-xs px-2 py-1 rounded bg-slate-200",onClick:t,children:e?"Hide":"Show"}),r.jsx("button",{className:"text-xs px-2 py-1 rounded bg-slate-200",onClick:n,children:"Clear"})]})]}),e&&(0,r.jsxs)("div",{className:"max-h-64 overflow-auto p-2 text-xs font-mono",children:[0===s.length&&r.jsx("div",{className:"text-slate-500",children:"No events yet…"}),s.map((e,t)=>(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsxs)("div",{className:"text-slate-500",children:["[",e.t,"] ",e.type||"event"]}),r.jsx("pre",{className:"whitespace-pre-wrap break-words",children:function(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}(e.data)})]},t)),r.jsx("div",{ref:i})]})]})}function p({items:e,onClose:t}){return r.jsx("div",{className:"fixed top-3 right-3 z-50 space-y-2",children:e.map(e=>(0,r.jsxs)("div",{className:"bg-emerald-600 text-white text-sm px-3 py-2 rounded shadow",children:[r.jsx("span",{className:"mr-2",children:"✓"}),e.text,t&&r.jsx("button",{className:"ml-3 text-white/80 hover:text-white",onClick:()=>t(e.id),"aria-label":"Dismiss",children:"\xd7"})]},e.id))})}let h="force-dynamic";function x(){let e=(0,n.useSearchParams)(),t=(0,n.useRouter)(),s=e.get("sessionId")||`sess_${Date.now()}`,[i,l]=(0,a.useState)(!1),[o,c]=(0,a.useState)([]),[d,h]=(0,a.useState)({}),[x,f]=(0,a.useState)([]),b=(0,a.useRef)([]);(0,a.useRef)(null);let g=(0,a.useRef)(!1),[y,v]=(0,a.useState)(""),j=(0,a.useRef)(o),w=(0,a.useRef)(d),N=(0,a.useRef)(y),[k,C]=(0,a.useState)(!1),[S,$]=(0,a.useState)([]);(0,a.useRef)(0),(0,a.useRef)(!1);let[P,_]=(0,a.useState)(null),[q,R]=(0,a.useState)(!1),[T,D]=(0,a.useState)(!1),W=(0,a.useRef)({idx:null,text:null});function A(e){let t=new Set,s=[];for(let r of e){let e=r.question.trim().toLowerCase();t.has(e)||(t.add(e),s.push(r))}return s}async function M(e){try{if(g.current)return;g.current=!0;let t=Math.max(0,4-x.length),s=await fetch("/api/nbq",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lastUtterance:e,checklist:w.current,goal:N.current,count:Math.max(1,Math.min(3,t))})}),r=await s.json(),a=(r.nbqs||(r.nbq?[r.nbq]:[])).map(e=>({...e,source:"refine"}));a.length&&f(e=>A([...e,...a]).slice(0,4))}catch(e){}finally{g.current=!1}}let[I,L]=(0,a.useState)([]),G=(0,a.useRef)(new Set);return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h1",{className:"text-xl font-semibold",children:"Live Discovery"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("input",{value:y,onChange:e=>v(e.target.value),placeholder:"End goal (optional): e.g., qualify for pilot",className:"text-sm border rounded px-2 py-1 w-56"}),(0,r.jsxs)("button",{disabled:q,onClick:async()=>{let e=j.current.map(e=>`${e.speaker}: ${e.text}`).join("\n");try{R(!0);let r=await fetch(`/api/finalize/${s}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcript:e,goal:y})}),a=await r.json().catch(async()=>({error:await r.text()}));try{a?.summary&&localStorage.setItem(`summary:${s}`,JSON.stringify(a.summary)),e&&localStorage.setItem(`transcript:${s}`,e)}catch{}if(!r.ok){if(a?.summary){t.push(`/dashboard/${s}?local=1`);return}throw Error(a?.error||`HTTP ${r.status}`)}t.push(`/dashboard/${s}`)}catch(e){_(e?.message||"Failed to finalize session")}finally{R(!1)}},className:"btn btn-primary flex items-center gap-2 "+(q?"opacity-60 cursor-not-allowed":""),children:[q&&r.jsx("span",{className:"inline-block w-3 h-3 rounded-full border-2 border-white border-t-transparent animate-spin"}),r.jsx("span",{children:q?"Saving…":"End & Save Summary"})]})]})]}),P&&r.jsx("div",{className:"text-xs text-red-600",children:P}),r.jsx(u,{sessionId:s,connected:i,transcript:o,coverage:d,nbqItems:x,goodMoment:T,onNbqActionAt:(e,t)=>{f(t=>{let s=[...t];return s.splice(e,1),s});let s=function(e,t,s,r){let a=Object.entries(t||{}).filter(([e,t])=>!(t&&"known"===t.toLowerCase())).map(([e])=>e.toLowerCase()),n=[],i=(s||"").toLowerCase();for(let t of[{key:"context",label:"Context & Rapport",templates:["What does your organization do, and what’s your role in it?","What are your top business priorities this quarter or year?","How is success measured for you and your team?"]},{key:"current_situation",label:"Current Situation",templates:["What tools, systems, or processes are you using today?","What’s working well right now?","Where are the biggest challenges or bottlenecks?"]},{key:"drivers_challenges",label:"Business Drivers & Challenges",templates:["What key initiatives or strategic projects are underway?","What challenges are preventing you from hitting those goals?","Who is most impacted by these challenges?","What happens if these challenges aren’t solved?"]},{key:"metrics_impact",label:"Metrics & Impact",templates:["How do you measure the impact of these challenges today (time, cost, revenue, risk, CSAT)?","Can you quantify the cost of the problem (lost revenue, wasted hours, missed opportunities)?","What would solving this challenge unlock for you?"]},{key:"decision_process",label:"Decision & Buying Process",templates:["Who is typically involved in evaluating or approving solutions like this?","What does your internal decision-making process look like?","What is your expected timeline for solving this problem?","Are there any budget considerations or constraints we should be aware of?"]},{key:"success_criteria",label:"Success Criteria",templates:["What does success look like for you 6–12 months from now?","How will you evaluate if a solution is delivering value?","Are there specific KPIs or outcomes you must hit?"]},{key:"next_steps",label:"Next Steps",templates:["If we can help you solve this, what would be the best next step?","Who else should we bring into the conversation?","Would you like us to outline a tailored solution or business case for review?"]},{key:"risks",label:"Risks",templates:["Are there any risks or unknowns that would worry you about moving forward?"]}]){if(n.length>=1)break;let s=i.includes(t.key)||e.toLowerCase().includes(t.key),r=t.label;if(s||0===a.length||a.some(e=>r.toLowerCase().includes(e)))for(let e of t.templates){if(n.length>=1)break;n.push({id:`fast_${t.key}_${e.length}_${Math.random().toString(36).slice(2,6)}`,question:e,grounded_in:"playbook_templates",checklist_category:r,confidence:.55,source:"fast"})}}return n.slice(0,1)}(j.current.slice(-40).map(e=>e.text).join(" "),w.current,N.current,1);s.length&&f(e=>A([...e,...s]).slice(0,4))},onNbqRefreshNow:()=>{M(j.current.slice(-1)[0]?.text||"")},onQueueForPauseAt:e=>{let t=b.current[e];t&&(W.current={idx:e,text:t.question},function(e,t){if(!G.current.has(e)){G.current.add(e);let s=`${e}_${Date.now()}`;L(e=>[...e,{id:s,text:t}]),setTimeout(()=>L(e=>e.filter(e=>e.id!==s)),2500)}}(`queue_mark_${Date.now()}`,`Queued for next pause: ${t.question.slice(0,80)}`))}}),I.length>0&&r.jsx(p,{items:I}),r.jsx(m,{open:k,onToggle:()=>C(e=>!e),events:S,onClear:()=>$([])})]})}function f(){return r.jsx(a.Suspense,{fallback:r.jsx("div",{children:"Loading…"}),children:r.jsx(x,{})})}},2698:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n});var r=s(9899);s(5507);var a=s(6153);function n(){let e=(0,a.useRouter)();return r.jsx("div",{className:"sticky top-0 z-40 bg-slate-50/80 backdrop-blur border-b",children:(0,r.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-7 h-7 rounded bg-primary text-white flex items-center justify-center font-bold",children:"D"}),r.jsx("button",{className:"text-sm font-semibold",onClick:()=>e.push("/"),children:"Discovery Co-Pilot"})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{className:"btn btn-primary",onClick:()=>{let t=`sess_${crypto.randomUUID()}`;e.push(`/call?sessionId=${t}`)},children:"Start Call"})})]})})}},8207:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>n,dynamic:()=>a});var r=s(2772);let a=(0,r.createProxy)(String.raw`/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/call/page.tsx#dynamic`),n=(0,r.createProxy)(String.raw`/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/call/page.tsx#default`)},1163:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var r=s(5023),a=s(336),n=s.n(a);s(642),s(8003);let i=(0,s(3914).default)(()=>s.e(422).then(s.bind(s,7422)),{loadableGenerated:{modules:["app/layout.tsx -> ../components/NavBar"]},ssr:!1});function l({children:e}){return r.jsx("html",{lang:"en",className:n().variable,children:(0,r.jsxs)("body",{className:"bg-[color:var(--bg-canvas)] text-slate-900 min-h-screen font-sans",children:[r.jsx(i,{}),r.jsx("div",{className:"max-w-7xl mx-auto p-4",children:e})]})})}},642:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[942,897],()=>s(5530));module.exports=r})();