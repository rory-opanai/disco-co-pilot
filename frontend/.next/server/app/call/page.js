(()=>{var e={};e.id=293,e.ids=[293],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},5530:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c}),t(8207),t(1163),t(2874);var r=t(7105),a=t(5265),i=t(157),n=t.n(i),o=t(4665),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(s,l);let c=["",{children:["call",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,8207)),"/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/call/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1163)),"/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,2874,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/call/page.tsx"],u="/call/page",m={require:t,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/call/page",pathname:"/call",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},3672:(e,s,t)=>{Promise.resolve().then(t.bind(t,6033))},8981:()=>{},4084:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,3817,23)),Promise.resolve().then(t.t.bind(t,9323,23)),Promise.resolve().then(t.t.bind(t,2204,23)),Promise.resolve().then(t.t.bind(t,820,23)),Promise.resolve().then(t.t.bind(t,5915,23)),Promise.resolve().then(t.t.bind(t,1611,23))},6033:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>x,dynamic:()=>h});var r=t(9899),a=t(5507),i=t(6153);function n({items:e}){return r.jsx("div",{className:"h-96 overflow-y-auto space-y-1",children:e.map((e,s)=>(0,r.jsxs)("div",{className:"text-sm",children:[(0,r.jsxs)("span",{className:"font-medium "+("Customer"===e.speaker?"text-rose-700":"text-sky-700"),children:[e.speaker,":"]})," ",e.text]},s))})}let o=["Pain","Impact","Current Solution","Desired Outcome","Use Case","Stakeholders","Budget","Timeline","Decision Process","Risks","Metrics","Compliance"];function l({coverage:e}){let s=(0,a.useMemo)(()=>{let s=o.length,t=0;for(let s of o){let r=e[s];"known"===r?t+=1:"partial"===r&&(t+=.3)}return Math.round(t/s*100)},[e]);return(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"mb-2",children:["Progress: ",(0,r.jsxs)("span",{className:"font-semibold",children:[s,"%"]})]}),r.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm",children:o.map(s=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"w-2 h-2 rounded-full",style:{background:function(e){switch(e){case"known":return"#16a34a";case"partial":return"#f59e0b";default:return"#9ca3af"}}(e[s])}}),r.jsx("span",{children:s})]},s))})]})}var c=t(3977);function d({sessionId:e,connected:s,transcript:t,coverage:a,nbqItems:i,onNbqActionAt:o,onNbqRefreshNow:d}){return(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{title:"Open Questions",idx:0},{title:"Avg Response Time",idx:1},{title:"Resolved Today",idx:2},{title:"High Priority",idx:3}].map(e=>r.jsx(c.Z,{title:e.title,nbq:i[e.idx],onAccept:i[e.idx]?()=>o(e.idx,"accept"):void 0,onSkip:i[e.idx]?()=>o(e.idx,"skip"):void 0},e.title))}),(0,r.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{className:"md:col-span-2 border rounded p-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("div",{className:"font-semibold",children:"Transcription"}),r.jsx("div",{className:"text-xs "+(s?"text-green-600":"text-red-600"),children:s?"Connected":"Connecting..."})]}),r.jsx(n,{items:t})]}),(0,r.jsxs)("div",{className:"border rounded p-3",children:[r.jsx("div",{className:"font-semibold mb-2",children:"Checklist Progress"}),r.jsx(l,{coverage:a})]})]}),r.jsx("div",{className:"text-xs text-slate-500",children:"NBQs auto-refresh and replace when answered."})]})}function u({open:e,onToggle:s,events:t,onClear:i}){let n=(0,a.useRef)(null);return(0,r.jsxs)("div",{className:"border rounded",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-slate-100",children:[r.jsx("div",{className:"font-medium",children:"Realtime Debug"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("button",{className:"text-xs px-2 py-1 rounded bg-slate-200",onClick:s,children:e?"Hide":"Show"}),r.jsx("button",{className:"text-xs px-2 py-1 rounded bg-slate-200",onClick:i,children:"Clear"})]})]}),e&&(0,r.jsxs)("div",{className:"max-h-64 overflow-auto p-2 text-xs font-mono",children:[0===t.length&&r.jsx("div",{className:"text-slate-500",children:"No events yet…"}),t.map((e,s)=>(0,r.jsxs)("div",{className:"mb-2",children:[(0,r.jsxs)("div",{className:"text-slate-500",children:["[",e.t,"] ",e.type||"event"]}),r.jsx("pre",{className:"whitespace-pre-wrap break-words",children:function(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}(e.data)})]},s)),r.jsx("div",{ref:n})]})]})}function m({items:e,onClose:s}){return r.jsx("div",{className:"fixed top-3 right-3 z-50 space-y-2",children:e.map(e=>(0,r.jsxs)("div",{className:"bg-emerald-600 text-white text-sm px-3 py-2 rounded shadow",children:[r.jsx("span",{className:"mr-2",children:"✓"}),e.text,s&&r.jsx("button",{className:"ml-3 text-white/80 hover:text-white",onClick:()=>s(e.id),"aria-label":"Dismiss",children:"\xd7"})]},e.id))})}let h="force-dynamic";function p(){let e=(0,i.useSearchParams)(),s=(0,i.useRouter)(),t=e.get("sessionId")||`sess_${Date.now()}`,[n,o]=(0,a.useState)(!1),[l,c]=(0,a.useState)([]),[h,p]=(0,a.useState)({}),[x,f]=(0,a.useState)([]);(0,a.useRef)([]),(0,a.useRef)(null);let g=(0,a.useRef)(!1),[y,b]=(0,a.useState)(""),v=(0,a.useRef)(l),j=(0,a.useRef)(h),w=(0,a.useRef)(y),[N,k]=(0,a.useState)(!1),[S,P]=(0,a.useState)([]);(0,a.useRef)(0),(0,a.useRef)(!1);let[C,_]=(0,a.useState)(null),[R,q]=(0,a.useState)(!1);function W(e){let s=new Set,t=[];for(let r of e){let e=r.question.trim().toLowerCase();s.has(e)||(s.add(e),t.push(r))}return t}async function A(e){try{if(g.current)return;g.current=!0;let s=Math.max(0,4-x.length),t=await fetch("/api/nbq",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lastUtterance:e,checklist:j.current,goal:w.current,count:Math.max(1,Math.min(3,s))})}),r=await t.json(),a=(r.nbqs||(r.nbq?[r.nbq]:[])).map(e=>({...e,source:"refine"}));a.length&&f(e=>W([...e,...a]).slice(0,4))}catch(e){}finally{g.current=!1}}let[D,T]=(0,a.useState)([]);return(0,a.useRef)(new Set),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[r.jsx("h1",{className:"text-xl font-semibold",children:"Live Discovery"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("input",{value:y,onChange:e=>b(e.target.value),placeholder:"End goal (optional): e.g., qualify for pilot",className:"text-sm border rounded px-2 py-1 w-56"}),(0,r.jsxs)("button",{disabled:R,onClick:async()=>{let e=v.current.map(e=>`${e.speaker}: ${e.text}`).join("\n");try{q(!0);let r=await fetch(`/api/finalize/${t}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcript:e,goal:y})}),a=await r.json().catch(async()=>({error:await r.text()}));try{a?.summary&&localStorage.setItem(`summary:${t}`,JSON.stringify(a.summary)),e&&localStorage.setItem(`transcript:${t}`,e)}catch{}if(!r.ok){if(a?.summary){s.push(`/dashboard/${t}?local=1`);return}throw Error(a?.error||`HTTP ${r.status}`)}s.push(`/dashboard/${t}`)}catch(e){_(e?.message||"Failed to finalize session")}finally{q(!1)}},className:"bg-slate-800 text-white px-3 py-2 rounded flex items-center gap-2 "+(R?"opacity-60 cursor-not-allowed":""),children:[R&&r.jsx("span",{className:"inline-block w-3 h-3 rounded-full border-2 border-white border-t-transparent animate-spin"}),r.jsx("span",{children:R?"Saving…":"End & Save Summary"})]})]})]}),C&&r.jsx("div",{className:"text-xs text-red-600",children:C}),r.jsx(d,{sessionId:t,connected:n,transcript:l,coverage:h,nbqItems:x,onNbqActionAt:(e,s)=>{f(s=>{let t=[...s];return t.splice(e,1),t});let t=function(e,s,t,r){let a=Object.entries(s||{}).filter(([e,s])=>!(s&&"known"===s.toLowerCase())).map(([e])=>e.toLowerCase()),i=[],n=(t||"").toLowerCase();for(let s of[{key:"context",label:"Context & Rapport",templates:["What does your organization do, and what’s your role in it?","What are your top business priorities this quarter or year?","How is success measured for you and your team?"]},{key:"current_situation",label:"Current Situation",templates:["What tools, systems, or processes are you using today?","What’s working well right now?","Where are the biggest challenges or bottlenecks?"]},{key:"drivers_challenges",label:"Business Drivers & Challenges",templates:["What key initiatives or strategic projects are underway?","What challenges are preventing you from hitting those goals?","Who is most impacted by these challenges?","What happens if these challenges aren’t solved?"]},{key:"metrics_impact",label:"Metrics & Impact",templates:["How do you measure the impact of these challenges today (time, cost, revenue, risk, CSAT)?","Can you quantify the cost of the problem (lost revenue, wasted hours, missed opportunities)?","What would solving this challenge unlock for you?"]},{key:"decision_process",label:"Decision & Buying Process",templates:["Who is typically involved in evaluating or approving solutions like this?","What does your internal decision-making process look like?","What is your expected timeline for solving this problem?","Are there any budget considerations or constraints we should be aware of?"]},{key:"success_criteria",label:"Success Criteria",templates:["What does success look like for you 6–12 months from now?","How will you evaluate if a solution is delivering value?","Are there specific KPIs or outcomes you must hit?"]},{key:"next_steps",label:"Next Steps",templates:["If we can help you solve this, what would be the best next step?","Who else should we bring into the conversation?","Would you like us to outline a tailored solution or business case for review?"]},{key:"risks",label:"Risks",templates:["Are there any risks or unknowns that would worry you about moving forward?"]}]){if(i.length>=1)break;let t=n.includes(s.key)||e.toLowerCase().includes(s.key),r=s.label;if(t||0===a.length||a.some(e=>r.toLowerCase().includes(e)))for(let e of s.templates){if(i.length>=1)break;i.push({id:`fast_${s.key}_${e.length}_${Math.random().toString(36).slice(2,6)}`,question:e,checklist_category:r,confidence:.55,source:"fast"})}}return i.slice(0,1)}(v.current.slice(-40).map(e=>e.text).join(" "),j.current,w.current,1);t.length&&f(e=>W([...e,...t]).slice(0,4))},onNbqRefreshNow:()=>{A(v.current.slice(-1)[0]?.text||"")}}),D.length>0&&r.jsx(m,{items:D}),r.jsx(u,{open:N,onToggle:()=>k(e=>!e),events:S,onClear:()=>P([])})]})}function x(){return r.jsx(a.Suspense,{fallback:r.jsx("div",{children:"Loading…"}),children:r.jsx(p,{})})}},3977:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});var r=t(9899);function a({title:e,nbq:s,onAccept:t,onSkip:a}){return(0,r.jsxs)("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:[(0,r.jsxs)("div",{className:"text-slate-600 text-sm mb-2 flex items-center justify-between",children:[r.jsx("div",{className:"font-medium",children:e}),s?.source&&r.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded "+("fast"===s.source?"bg-sky-100 text-sky-700":"bg-emerald-100 text-emerald-700"),children:"fast"===s.source?"Fast":"Refined"})]}),s?(0,r.jsxs)("div",{className:"space-y-3",children:[r.jsx("div",{className:"text-xl font-semibold leading-snug",children:s.question}),(0,r.jsxs)("div",{className:"flex gap-2",children:[t&&r.jsx("button",{className:"bg-green-600 text-white text-xs px-2 py-1 rounded",onClick:t,children:"Accept"}),a&&r.jsx("button",{className:"bg-slate-200 text-slate-900 text-xs px-2 py-1 rounded",onClick:a,children:"Skip"})]})]}):r.jsx("div",{className:"text-slate-500 text-sm",children:"Awaiting suggestion…"})]})}t(5507)},6153:(e,s,t)=>{"use strict";var r=t(1545);t.o(r,"useParams")&&t.d(s,{useParams:function(){return r.useParams}}),t.o(r,"useRouter")&&t.d(s,{useRouter:function(){return r.useRouter}}),t.o(r,"useSearchParams")&&t.d(s,{useSearchParams:function(){return r.useSearchParams}})},8207:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>i,dynamic:()=>a});var r=t(2772);let a=(0,r.createProxy)(String.raw`/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/call/page.tsx#dynamic`),i=(0,r.createProxy)(String.raw`/Users/roryh/Github/Disco-co-pilot/disco-co-pilot/frontend/app/call/page.tsx#default`)},1163:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});var r=t(5023);function a({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{className:"bg-slate-50 text-slate-900",children:r.jsx("div",{className:"max-w-6xl mx-auto p-4",children:e})})})}t(642),t(8003)},642:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[942,371],()=>t(5530));module.exports=r})();