(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[293],{9250:function(e,t,s){Promise.resolve().then(s.bind(s,9231))},9231:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f},dynamic:function(){return p}});var n=s(7821),r=s(8078),i=s(8504);function a(e){let{items:t}=e;return(0,n.jsx)("div",{className:"h-96 overflow-y-auto space-y-1",children:t.map((e,t)=>(0,n.jsxs)("div",{className:"text-sm",children:[(0,n.jsxs)("span",{className:"font-medium "+("Customer"===e.speaker?"text-rose-700":"text-sky-700"),children:[e.speaker,":"]})," ",e.text]},t))})}function c(e){let{nbq:t,onAction:s}=e;return((0,r.useEffect)(()=>{let e=e=>{t&&("n"===e.key.toLowerCase()&&s("accept"),"s"===e.key.toLowerCase()&&s("skip"))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[t,s]),t)?(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)("div",{className:"text-sm text-slate-600",children:["Category: ",t.checklist_category]}),(0,n.jsx)("div",{className:"text-lg",children:t.question}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{className:"bg-green-600 text-white px-3 py-1 rounded",onClick:()=>s("accept"),children:"Accept (N)"}),(0,n.jsx)("button",{className:"bg-slate-300 text-slate-900 px-3 py-1 rounded",onClick:()=>s("skip"),children:"Skip (S)"})]})]}):(0,n.jsx)("div",{className:"text-slate-500",children:"Awaiting next suggestion…"})}let o=["Pain","Impact","Current Solution","Desired Outcome","Use Case","Stakeholders","Budget","Timeline","Decision Process","Risks","Metrics","Compliance"];function l(e){let{coverage:t}=e,s=(0,r.useMemo)(()=>{let e=o.length;return Math.round(o.filter(e=>["known","partial"].includes(t[e])).length/e*100)},[t]);return(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"mb-2",children:["Progress: ",(0,n.jsxs)("span",{className:"font-semibold",children:[s,"%"]})]}),(0,n.jsx)("div",{className:"grid grid-cols-2 gap-2 text-sm",children:o.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:"w-2 h-2 rounded-full",style:{background:function(e){switch(e){case"known":return"#16a34a";case"partial":return"#f59e0b";default:return"#9ca3af"}}(t[e])}}),(0,n.jsx)("span",{children:e})]},e))})]})}function u(e){let{sessionId:t,connected:s,transcript:r,coverage:i,nbq:o,onNbqAction:u}=e;return(0,n.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"md:col-span-2 border rounded p-3",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("div",{className:"font-semibold",children:"Live Transcript"}),(0,n.jsx)("div",{className:"text-xs "+(s?"text-green-600":"text-red-600"),children:s?"Connected":"Connecting..."})]}),(0,n.jsx)(a,{items:r})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"border rounded p-3",children:[(0,n.jsx)("div",{className:"font-semibold mb-2",children:"Checklist Progress"}),(0,n.jsx)(l,{coverage:i})]}),(0,n.jsxs)("div",{className:"border rounded p-3",children:[(0,n.jsx)("div",{className:"font-semibold mb-2",children:"Next Best Question"}),(0,n.jsx)(c,{nbq:o,onAction:u}),(0,n.jsx)("div",{className:"text-xs text-slate-500 mt-2",children:"Hotkeys: N = accept, S = skip"})]})]})]})}var d=s(2949);class h{on(e){this.listeners.add(e)}off(e){this.listeners.delete(e)}emit(e){this.listeners.forEach(t=>t(e))}async start(){let e=await fetch("/api/realtime/ephemeral").then(e=>e.json());if(!(null==e?void 0:e.client_secret))throw Error("Failed to obtain ephemeral key");let t=e.client_secret,s=e.model||d.env.NEXT_PUBLIC_REALTIME_MODEL||"gpt-4o-realtime-preview-2024-12-17",n=new RTCPeerConnection;this.pc=n;let r=n.createDataChannel("oai-events");this.dc=r,r.onmessage=e=>{try{let t=JSON.parse(e.data);this.emit(t)}catch(e){}};let i=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}});i.getTracks().forEach(e=>n.addTrack(e,i));let a=await n.createOffer();await n.setLocalDescription(a);let c="https://api.openai.com/v1/realtime?model=".concat(encodeURIComponent(s)),o=await fetch(c,{method:"POST",headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/sdp"},body:a.sdp}),l=await o.text();await n.setRemoteDescription({type:"answer",sdp:l})}async stop(){var e,t,s;try{null===(e=this.dc)||void 0===e||e.close()}catch(e){}try{null===(t=this.pc)||void 0===t||t.getSenders().forEach(e=>{var t;return null===(t=e.track)||void 0===t?void 0:t.stop()})}catch(e){}try{null===(s=this.pc)||void 0===s||s.close()}catch(e){}}constructor(){this.pc=null,this.dc=null,this.listeners=new Set}}let p="force-dynamic";function m(){let e=(0,i.useSearchParams)(),t=(0,i.useRouter)(),s=e.get("sessionId")||"sess_".concat(Date.now()),[a,c]=(0,r.useState)(!1),[o,l]=(0,r.useState)([]),[d,p]=(0,r.useState)({}),[m,f]=(0,r.useState)(null),x=(0,r.useRef)(o),v=(0,r.useRef)(d);return(0,r.useEffect)(()=>{x.current=o},[o]),(0,r.useEffect)(()=>{v.current=d},[d]),(0,r.useEffect)(()=>{let e=new h;return e.on(async e=>{if("response.output_text.delta"===e.type){let t=e.delta||"";t.trim()&&l(e=>[...e,{speaker:"Customer",text:t,timestamp:new Date().toISOString()}])}if("response.completed"===e.type){let e=x.current.slice(-40).map(e=>e.text).join(" ");if(e)try{let t=await fetch("/api/coverage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({transcriptWindow:e})}).then(e=>e.json());if(Array.isArray(t.coverage)){let e={...v.current};for(let s of t.coverage)e[s.category]=s.status;p(e)}let s=e.split(/\n|\.\s/).slice(-1)[0]||e,n=await fetch("/api/nbq",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({lastUtterance:s,checklist:v.current})}).then(e=>e.json());n.nbq&&f(n.nbq)}catch(e){}}}),e.start().then(()=>c(!0)).catch(()=>c(!1)),()=>{e.stop()}},[s]),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold",children:"Live Discovery"}),(0,n.jsx)("button",{onClick:()=>t.push("/dashboard/".concat(s)),className:"bg-slate-800 text-white px-3 py-2 rounded",children:"End & View Summary"})]}),(0,n.jsx)(u,{sessionId:s,connected:a,transcript:o,coverage:d,nbq:m,onNbqAction:e=>f(null)})]})}function f(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{children:"Loading…"}),children:(0,n.jsx)(m,{})})}},8504:function(e,t,s){"use strict";var n=s(3226);s.o(n,"useParams")&&s.d(t,{useParams:function(){return n.useParams}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}}),s.o(n,"useSearchParams")&&s.d(t,{useSearchParams:function(){return n.useSearchParams}})},2949:function(e,t,s){"use strict";var n,r;e.exports=(null==(n=s.g.process)?void 0:n.env)&&"object"==typeof(null==(r=s.g.process)?void 0:r.env)?s.g.process:s(3862)},3862:function(e){!function(){var t={229:function(e){var t,s,n,r=e.exports={};function i(){throw Error("setTimeout has not been defined")}function a(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{s="function"==typeof clearTimeout?clearTimeout:a}catch(e){s=a}}();var o=[],l=!1,u=-1;function d(){l&&n&&(l=!1,n.length?o=n.concat(o):u=-1,o.length&&h())}function h(){if(!l){var e=c(d);l=!0;for(var t=o.length;t;){for(n=o,o=[];++u<t;)n&&n[u].run();u=-1,t=o.length}n=null,l=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===a||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];o.push(new p(e,t)),1!==o.length||l||c(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},s={};function n(e){var r=s[e];if(void 0!==r)return r.exports;var i=s[e]={exports:{}},a=!0;try{t[e](i,i.exports,n),a=!1}finally{a&&delete s[e]}return i.exports}n.ab="//";var r=n(229);e.exports=r}()}},function(e){e.O(0,[115,364,744],function(){return e(e.s=9250)}),_N_E=e.O()}]);